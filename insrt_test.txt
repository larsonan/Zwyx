bytes~{
	c0~int:0 c1~int c2~int c3~int c4~int c5~int
	
}

interface~{
	ignore~int
	
	
	fn~;
	;~{fn}
}

writenf~{
	~interface
	data~arr_ptr
	s~{
		b~arr_ptr
		;~{
			data:b
			;
		}
	}
	c~{
		in~int
		;~{
			b~bytes.{c0:in}
			data:@b
			data.count:1
			;
		}
	}
	
	endl~{
		;~{
			c:10
		}
	}
	d~{
		in~int
		;~{
			intb~bytes
			p~@bytes:@intb
			p:{p+40}
			p.c0:{in%10+48}
			in:{in/10}
			p:{p-8}
			size~int:1
			
			{in > 0}#{
				p.c0:{in%10+48}
				in:{in/10}
				p:{p-8}
				size:{size+1}
			}
			data:{p+8}
			data.count:size
			;
		}
	}
}

print~{
	~writenf
	fn:@{
		_console_write:data
	}
}
list~{
	b~arr_ptr
	set_buffer~{
		in~int
		;~{
			b:in
			b.count:0
		}
	}
	set~{
		at~int
		char~int
		;~{
			p~@bytes:{b+{at*8}}
			p.c0:char
		}
	}
	add~{
		in~int
		;~{
			set.{at:b.count char:in ;}
			b.count:{b.count + 1}
		}
	}
	each~{
		
		f~;
		;~{
			p~@bytes:b
			remaining~int
			remaining:b.count
			
			{remaining > 0}#{
				mbr~@bytes:p.c0
				mbr.{f}
				
				
				p:{p+8}
				remaining:{remaining-1}
			}
		}
	}
}









str~{
	
	~list
	write~{
		~writenf
		fn:@{
			in~@bytes:data
			self~@bytes:b
			self:{self+{b.count*8}}
			countin~int:data.count
			b.count:{b.count+countin}
			{countin > 0}#{
				self.c0:in.c0
				self:{self+8}
				
				in:{in+8}
				countin:{countin-1}
			}
		}
	}
}
npair~{a~int b~int}
b1~npair.{a:0 b:1}
b2~npair.{a:2 b:5}
b3~npair.{a:0 b:5}
b4~npair.{a:2 b:7}
b5~npair.{a:4 b:1}
b0~bytes

npairlist~{
	~list
	eachnpair~{
		in~npair.;
		;~{each:in}
	}
}

l~npairlist.{
	set_buffer:@b0
	add.{
		$:@b1 ; $:@b2 ; $:@b3 ; $:@b4 ; $:@b5 ;
	}
}

l.eachnpair:@{print.d:{a+b}}

getmsg~{
	write~@writenf
	;~{
		write.{c:72 c:69 c:76 c:76 c:79}
	}
	
}


print.{
	hello~bytes
	msg~str
	msg.set_buffer:@hello
	msg.write.{getmsg:@$}
	getmsg:@$
	msg.set.{char:70 at:1 ; at:2 ; at:3 ; at:4 ;}
	s:msg
	d:1749 c:102 d:0 c:90 endl
}

factorial~{
	in~int
	;~{
		{in < 2} ? 1 ! {in * factorial:{in-1}}
	}
}

print.{d:factorial:7 endl}

enum~{
	val~int
	op~{
		op_val~int
		is~{
			;~{val=op_val}
		}
		set~{
			;~{val:op_val}
		}
	}
}

color~{
	~enum
	red~{~op op_val:0}
	green~{~op op_val:1}
	orange~{~op op_val:2}
	yellow~{~op op_val:3}
	blue~{~op op_val:4}
}

color_a~color
color_a.blue.set
print.{d:color_a.blue.is endl d:color_a.orange.is endl}

write_color~{
	write~@writenf
	colrw~color
	;~{
		write.{
			colrw.{
				red.is ? {c:82 c:69 c:68}
				! green.is ? {c:71 c:82 c:69 c:69 c:78}
				! orange.is ? {c:79 c:82 c:65 c:78 c:71 c:69}
				! yellow.is ? {c:89 c:69 c:76 c:76 c:79 c:87}
				! blue.is ? {c:66 c:76 c:85 c:69}
			}
			endl
		}
	}
}

printer~print
write_color.{write:@printer colrw:color_a ; color_a.orange.set colrw:color_a ;}

