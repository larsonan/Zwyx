interface~{
	fn~;
	;~{fn}
}

boxed~`
        return~{
                el~@_in
        }
`

c_iter~{
	el~int.8
	
}

writenf~{
	~interface
	data~inset:bytes
	s~{
		b~bytes
		;~{
			data:b
			;
		}
	}
	c~{
		in~int
		;~{
			b~int.8
			b:in
			data:@b
			data.count:1
			;
		}
	}
	
	endl~{
		;~{
			_endl
		}
	}
	line~{
		b~bytes
		;~{
			s:b
			endl
		}
	}
	d~{
		in~int
		;~{
			buff~bytes.48
			it~@c_iter:@buff
			it:{it+40}
			it.el:{in%10+48}
			in:{in/10}
			it:{it-1}
			size~int:1
			
			{in > 0}?*{
				it.el:{in%10+48}
				in:{in/10}
				it:{it-1}
				size:{size+1}
			}
			data:{it+1}
			data.count:size
			;
		}
	}
}

print~{
	~writenf
	fn:@{
		_console_write:data
	}
}
list~template:`return~{
	b~bytes
	set_buffer~{
		in~bytes
		;~{
			b:in
			b.count:0
		}
	}
	get~{
		at~int
		;~{
			it~@boxed:_in:{b+{at*8}}
			it.el
		}
	}
	set~{
		at~int
		char~@_in
		;~{
			it~@boxed:_in:{b+{at*8}}
			it.el:char
		}
	}
	add~{
		in~@_in
		;~{
			set.{at:b.count char:in ;}
			b.count:{b.count + 1}
		}
	}
	count~{
		;~{
			b.count
		}
	}
	each~{
		
		f~_in.;
		;~{
			it~@boxed:_in:b
			
			remaining~int
			remaining:b.count
			
			{remaining > 0}?*{
				mbr~@_in:it.el
				mbr.{f}
				
				
				it:{it+8}
				remaining:{remaining-1}
			}
		}
	}
}`









str~{
	b~bytes
	set_buffer~{
		in~bytes
		;~{
			b:in
			b.count:0
		}
	}
	setchar~{
		at~int
		char~int
		;~{
			it~@c_iter:{b+at}
			it.el:char
		}
	}
	getchar~{
		at~int
		;~{
			it~@c_iter:{b+at}
			it.el % 256
		}
	}
	count~{
		;~{
			b.count
		}
	}
	write~{
		~writenf
		fn:@{
			in~@c_iter:data
			self~@c_iter:b
			self:{self+b.count}
			countin~int:data.count
			b.count:{b.count+countin}
			{countin > 0}?*{
				self.el:in.el
				self:{self+1}
				
				in:{in+1}
				countin:{countin-1}
			}
		}
	}
}

enum~{
	val~int
	op~{
		op_val~int
		is~{
			;~{val=op_val}
		}
		set~{
			;~{val:op_val}
		}
	}
}

emplacementList~template:`return~{
	~list:_in
	membSize~int
	membBuffer~bytes
	set_membBuffer~{
		buf~bytes
		;~{
			membBuffer:buf
			membBuffer.count:0
		}
	}
	emplace~{
		in~_in.;
		;~{
			ptr~@_in:{membBuffer+membBuffer.count}
			ptr.{in}
			membBuffer.count:{membBuffer.count+membSize}
			add:ptr
		}
	}
}`

virtual~`
        return~_in.;
        _in.;~{return}
`
GetChar~{
        ;~{
                c~int.8
                _console_read.{a:@c size:1 ;}
                
                result~int:0
                result
                c
        }
}

Counter~{
        start~int:0
        end~int
        step~int:1
        i~int
        do~;
        ;~{
                i:start
                {i < end}?*{
                        do
                        i:{i+step}
                }
        }
}

