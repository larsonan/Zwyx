_import:"utilities_lib"


CellularAutomaton~{
        rule~int
        iters~int
        wrput~@writenf
        ;~{
                ruleTableBuffer~bytes.8
                ruleTable~str.{
                        set_buffer:@ruleTableBuffer
                        Counter.{remainder~int:rule end:8 do:@{
                                write.c:{remainder%2}
                                remainder:{remainder/2}
                        } ; }
                }
                
                stateBuffer~bytes.22
                state~str.{
                        set_buffer:@stateBuffer
                        write.{
                                c:0
                                c:0 c:0 c:0 c:0 c:1 c:0 c:0 c:0 c:0 c:0
                                c:0 c:0 c:0 c:0 c:0 c:0 c:0 c:0 c:0 c:0
                                c:0
                        }
                }
                
                Counter.{end:iters do:@{
                        prevCell~int:0
                        Counter.{start:1 end:21 do:@{
                                {state.getchar:i = 1}?{
                                        wrput.c:"Z"
                                }^{
                                        wrput.c:"."
                                }
                                currCell~int:ruleTable.getchar:state.getchar.{
                                        {$:{i-1} ;} + {{$:i ;} * 2} + {{$:{i+1} ;} * 4}
                                
                                }
                                state.setchar.{char:prevCell at:{i-1} ;}
                                prevCell:currCell
                        } ; }
                        
                        state.setchar.{char:prevCell at:20 ;}
                        wrput.endl
                } ; }
        }
}

;~{
        File.{
                name:"output.txt"
                open
                write.{
                        CellularAutomaton.{
                                rule:110
                                iters:10
                                wrput:@$.2
                                ;
                        }
                }
                close
        }
}

